<link rel="stylesheet" href="https://bootswatch.com/5/lux/bootstrap.min.css" />
<h1 class="text-center">Template Generator</h1>

<form class="form-group row gap-4">
  <div class="form-group">
    <label class="form-label mt-4">PROMPT :</label>
    <input type="text" name="prompt" class="form-control" />
    <small class="form-text text-muted"
      >describe what you want to create.</small
    >
  </div>

  <div class="d-flex flex-row justify-content-between">
    <button type="submit" class="btn btn-primary">Generate</button>
    <button type="reset" class="btn btn-outline-secondary">Cancel</button>
  </div>

  <div class="progress d-none">
    <div
      class="progress-bar"
      role="progressbar"
      style="width: 25%"
      aria-valuenow="25"
      aria-valuemin="0"
      aria-valuemax="100"
    ></div>
  </div>
</form>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body {
    padding: 20px;
  }
</style>

<script>
  const cancelBtn = document.querySelector('button[type="reset"]');
  cancelBtn.addEventListener('click', () => {
    parent.postMessage({ pluginMessage: { type: 'actionExit' } }, '*');
  });

  const submitBtn = document.querySelector('button[type="submit"]');
  submitBtn.addEventListener('click', () => {
    event.preventDefault();
    // get the form
    const form = document.querySelector('form');
    // get the form data
    const formData = new FormData(form);
    // create an object from the form data
    const data = Object.fromEntries(formData);
    // console.log(data);

    parent.postMessage(
      {
        pluginMessage: {
          type: 'actionGenerate',
          data,
        },
      },
      '*'
    );
  });

  onmessage = (event) => {
    const { progress } = event.data.pluginMessage;

    if (progress) {
      const progressEl = document.querySelector('.progress');
      progressEl.classList.remove('d-none');
      const progressBar = document.querySelector('.progress-bar');
      progressBar.style.width = `${progress}%`;
      progressBar.setAttribute('aria-valuenow', progress);
      if (progress === 100) {
        setTimeout(() => {
          progressEl.classList.add('d-none');
          parent.postMessage({ pluginMessage: { type: 'actionExit' } }, '*');
        }, 1000);
      }
    }
  };
</script>
